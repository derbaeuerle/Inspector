/*! PROJECT_NAME - v0.1.0 - 2013-06-09
* http://PROJECT_WEBSITE/
* Copyright (c) 2013 YOUR_NAME; Licensed MIT */
inspector={initCommand:"inspector://init/",destroyCommand:"inspector://destroy/",serverAddress:"http://localhost:9090/inspector/",gadgets:{AUDIO:"AUDIO",ACCELERATION:"ACCELERATION",GYROSCOPE:"GYROSCOPE",TEMPERATURE:"TEMPERATURE",LIGHT:"LIGHT",MAGNETIC:"MAGNETIC",ORIENTATION:"ORIENTATION",PRESSURE:"PRESSURE",PROXIMITY:"PROXIMITY"},listeners:{},browser:null,timeout:-1,init:function(){uMatch=navigator.userAgent.match(/Chrome\/[0-9]{1,2}/),uMatch&&uMatch.length>=1&&(inspector.browser=parseInt(uMatch[0].replace("Chrome/",""),10),inspector.browser=inspector.browser>=25?inspector.browser:null),window.onblur=inspector.destroyInspector,inspector.initInspector()},initInspector:function(){inspector.browser?inspector.sendIntent("intent://init/#Intent;scheme=inspector;package=de.hsrm.inspector;end"):inspector.sendIntent(inspector.initCommand)},destroyInspector:function(){inspector.destroyListeners(),inspector.browser?inspector.sendIntent("intent://init/#Intent;scheme=inspector;package=de.hsrm.inspector;end"):inspector.sendIntent(inspector.destroyCommand)},destroyListeners:function(){for(var a in inspector.listeners){var b=inspector.listeners[a];for(var c in b)inspector.unlisten(a,c)}},sendIntent:function(a){iframe=document.createElement("iframe"),iframe.id="ajaxFrame",iframe.style.display="none",iframe.onerror=function(a){document.body.removeChild(iframe),console.log(a)},inspector.browser?(window.onbeforeunload=function(){window.location="#",window.stop()},window.location=a):iframe.src=a,document.body.appendChild(iframe)},listen:function(a,b,c){return a in inspector.listeners||(inspector.listeners[a]=[]),id=window.setInterval(function(){inspector.call(a,b,c)},500),inspector.listeners[a][id]=id,id},unlisten:function(a,b){a in inspector.listeners&&b in inspector.listeners[a]&&(gadgetListeners=inspector.listeners[a],window.clearInterval(gadgetListeners[b]),delete gadgetListeners[gadgetListeners.indexOf(b)])},call:function(a,b,c){url=inspector.serverAddress+a+"/";var d="inspector"+Math.floor((new Date).getTime()/Math.random());url+="?callback=inspector."+d;for(var e in b)b.hasOwnProperty(e)&&(url+="&"+e+"="+b[e]);script=document.createElement("script"),script.onerror=inspector.onError,this[d]=function(a){try{c(a)}finally{delete this[d],script.parentNode.removeChild(script)}},script.src=url,document.body.appendChild(script)},onError:function(a){if(-1===inspector.timeout)inspector.timeout=20,inspector.timeout--,inspector.initInspector();else if(inspector.timeout>0)inspector.initInspector(),inspector.timeout--;else if(0===inspector.timeout)throw new Exception("Failed to establish connection!");console.error(a)}},window.onload=inspector.init,inspector.audio={id:0,template:'<button id="play" onclick="inspector.audio.onClick(this);">Play</button><button id="pause" onclick="inspector.audio.onClick(this);">Pause</button><button id="stop" onclick="inspector.audio.onClick(this);">Stop</button>',onClick:function(a){"play"===a.id?inspector.call(inspector.gadgets.AUDIO,{audiofile:a.parentNode.getAttribute("src"),"do":"play",playerid:a.getAttribute("playerid")},function(b){a.setAttribute("playerid",b.playerid),console.log(b)}):"pause"===a.id?inspector.call(inspector.gadgets.AUDIO,{audiofile:a.parentNode.getAttribute("src"),"do":"pause",playerid:a.getAttribute("playerid")},function(b){a.setAttribute("playerid",b.playerid),console.log(b)}):"stop"===a.id&&inspector.call(inspector.gadgets.AUDIO,{audiofile:a.parentNode.getAttribute("src"),"do":"stop",playerid:a.getAttribute("playerid")},function(b){a.setAttribute("playerid",b.playerid),console.log(b)})},init:function(){var a=document.getElementsByTagName("audio");for(i=0;i<a.length;i++){id="iaudio"+inspector.audio.id++;var b=document.createElement("inspector-audio");b.id=id,b.setAttribute("src",a[0].getElementsByTagName("source")[0].getAttribute("src")),b.innerHTML=inspector.audio.template,a[i].parentNode.replaceChild(b,a[i])}}},window.onload=inspector.audio.init;