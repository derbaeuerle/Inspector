/*! PROJECT_NAME - v0.1.0 - 2013-07-06
* http://PROJECT_WEBSITE/
* Copyright (c) 2013 YOUR_NAME; Licensed MIT */
function addLoadEvent(a){var b=window.onload;window.onload="function"!=typeof window.onload?a:function(){b&&b(),a()}}function getElementByAttribute(a,b,c){if(c=c||document.body,c.hasAttribute(a)&&c.getAttribute(a)==b)return c;for(var d,e=c.children,f=e.length;f--;)if(d=getElementByAttribute(a,b,e[f]))return d;return null}inspector={initCommand:"inspector://init/",destroyCommand:"inspector://destroy/",serverAddress:"http://localhost:9090/inspector/",gadgets:{AUDIO:"AUDIO",ACCELERATION:"ACCELERATION",GYROSCOPE:"GYROSCOPE",TEMPERATURE:"TEMPERATURE",LIGHT:"LIGHT",MAGNETIC:"MAGNETIC",ORIENTATION:"ORIENTATION",PRESSURE:"PRESSURE",PROXIMITY:"PROXIMITY"},listeners:{},timeout:-1,init:function(){inspector.initInspector();var a=document.createEvent("Event");a.initEvent("inspector-ready",!0,!0),window.dispatchEvent(a)},initInspector:function(){inspector.sendIntent(inspector.initCommand)},destroyInspector:function(){inspector.destroyListeners(),inspector.sendIntent(inspector.destroyCommand)},destroyListeners:function(){for(var a in inspector.listeners){var b=inspector.listeners[a];for(var c in b)inspector.unlisten(a,c)}},sendIntent:function(a){iframe=document.createElement("iframe"),iframe.id="ajaxFrame",iframe.style.display="none",iframe.onerror=function(a){document.body.removeChild(iframe),console.log(a)},inspector.browser?(window.onbeforeunload=function(){window.location="#",window.stop()},window.location=a):iframe.src=a,document.body.appendChild(iframe)},listen:function(a,b,c,d){return a in inspector.listeners||(inspector.listeners[a]=[]),streamId="inspector"+parseInt(1e3*((new Date).getTime()/Math.random()),10),b.id=streamId,inspector.call(a,b,c,d),inspector.listeners[a][streamId]=streamId,streamId},unlisten:function(a,b){a in inspector.listeners&&b in inspector.listeners[a]&&delete inspector.listeners[a][b]},onEvent:function(a,b,c,d){window.setTimeout(function(){inspector.call(a,b,c,d)},100)},call:function(a,b,c,d,e){url=inspector.serverAddress+a+"/";var f="inspector"+parseInt(1e3*((new Date).getTime()/Math.random()),10);url+="?callback=inspector."+f;for(var g in b)b.hasOwnProperty(g)&&(url+="&"+g+"="+b[g]);script=document.createElement("script"),script.onerror=function(f){d&&d(f,a,b,c,d),e&&e>0&&(inspector.initInspector(),window.setTimeout(function(){e-=1,inspector.call(a,b,c,d,e)},200))},inspector[f]=function(e){try{e.error?d(e):c(e),b.id&&inspector.listeners[a][b.id]&&(e.error&&e.error.code&&1==e.error.code&&inspector.unlisten(a,b.id),inspector.onEvent(a,b,c,d,e))}finally{delete inspector[f],script.parentNode.removeChild(script)}},script.src=url,document.body.appendChild(script)},logger:function(a){console.log(a)}},addLoadEvent(inspector.init),inspector.audio={id:1,template:'<inspector-audio-state>unknown</inspector-audio-state><button inspector-action="play" onclick="inspector.audio.onClick(this);">Play</button><button inspector-action="pause" onclick="inspector.audio.onClick(this);">Pause</button><button inspector-action="stop" onclick="inspector.audio.onClick(this);">Stop</button>',instances:{},elements:[],force:!0,onClick:function(b){for(action=b.getAttribute("inspector-action"),file=b.parentNode.getAttribute("src"),playerid=b.parentNode.getAttribute("inspector-playerid"),-1===file.indexOf("http")&&(loc=window.location.href,file=loc.indexOf("/",loc.length-1)?loc+file:loc+"/"+file),file=encodeURIComponent(file),opts={audiofile:file,"do":action},a=0;a<b.parentNode.attributes.length;a++)attr=b.parentNode.attributes[a],attr.value===!0||""===attr.value?attr.value=!0:attr.value||(attr.value=!1),opts[attr.name.replace("inspector-","")]=attr.value;inspector.call(inspector.gadgets.AUDIO,opts,function(a){var c=document.createEvent("Event");c.initEvent("state",!0,!0),c.detail=a,c.request={message:action,audiofile:file,playerid:playerid,response:a},b.parentNode.dispatchEvent(c),inspector.audio.updateState(b.parentNode,a)},null,20),"play"===action?window.setTimeout(function(){inspector.audio.instances[playerid]=inspector.listen(inspector.gadgets.AUDIO,{"do":"state",playerid:playerid},function(a){var c=document.createEvent("Event");c.initEvent("state",!0,!0),c.detail=a,b.parentNode.dispatchEvent(c),inspector.audio.updateState(b.parentNode,a)})},1e3):window.setTimeout(function(){inspector.unlisten(inspector.gadgets.AUDIO,inspector.audio.instances[playerid])},500)},updateState:function(a,b){sEl=a.getElementsByTagName("inspector-audio-state"),sEl.length>0&&(sEl=sEl[0],sEl.innerHTML=b.state||"unknown")},needReplacement:function(a){for(srcs=a.getElementsByTagName("source"),x=0;x<srcs.length;x++)if(a.canPlayType(srcs[x].getAttribute("type")))return!1;return!0},check:function(){var a=document.getElementsByTagName("audio");for(i=0;i<a.length;i++)if(audio=a[i],inspector.audio.force||inspector.audio.needReplacement(audio)){id=(new Date).getTime()/inspector.audio.id++,id/=Math.floor(1001*Math.random()),id="iaudio"+id;var b=document.createElement("inspector-audio");for(b.setAttribute("inspector-playerid",id),b.setAttribute("src",audio.getElementsByTagName("source")[0].getAttribute("src")),b.innerHTML=inspector.audio.template,o=0;o<audio.attributes.length;o++)b.setAttribute(audio.attributes[o].name,audio.attributes[o].value);b.play=function(){el=getElementByAttribute("inspector-action","play",b),el&&el.click()},b.stop=function(){el=getElementByAttribute("inspector-action","stop",b),el&&el.click()},b.stop=function(){el=getElementByAttribute("inspector-action","pause",b),el&&el.click()},b.seek=function(a){inspector.call(inspector.gadgets.AUDIO,{audiofile:b.getAttribute("src"),"do":"seek",playerid:b.getAttribute("inspector-playerid"),seekto:a},function(a){var c=document.createEvent("Event");c.initEvent("state",!0,!0),c.detail=a,b.dispatchEvent(c),inspector.audio.updateState(b,a)})},b.volume=function(a){inspector.call(inspector.gadgets.AUDIO,{audiofile:b.getAttribute("src"),"do":"volume",playerid:b.getAttribute("inspector-playerid"),volume:a},function(a){var c=document.createEvent("Event");c.initEvent("state",!0,!0),c.detail=a,b.dispatchEvent(c),inspector.audio.updateState(b,a)})},b.leftVolume=function(a){inspector.call(inspector.gadgets.AUDIO,{audiofile:b.getAttribute("src"),"do":"volume",playerid:b.getAttribute("inspector-playerid"),"volume-left":a},function(a){var c=document.createEvent("Event");c.initEvent("state",!0,!0),c.detail=a,b.dispatchEvent(c),inspector.audio.updateState(b,a)})},b.rightVolume=function(a){inspector.call(inspector.gadgets.AUDIO,{audiofile:b.getAttribute("src"),"do":"volume",playerid:b.getAttribute("inspector-playerid"),"volume-right":a},function(a){var c=document.createEvent("Event");c.initEvent("state",!0,!0),c.detail=a,b.dispatchEvent(c),inspector.audio.updateState(b,a)})},audio.parentNode.replaceChild(b,audio),inspector.audio.elements.push(b),i--,inspector.audio.autoplay(b)}},autoplay:function(a){(a.getAttribute("autoplay")||""===a.getAttribute("autoplay"))&&a.play()},init:function(){inspector.audio.check();var a=document.createEvent("Event");a.initEvent("inspector-audio-ready",!0,!0),window.dispatchEvent(a)}},addLoadEvent(inspector.audio.init);